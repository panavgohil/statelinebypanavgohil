<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Stateline Login</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@900&family=Inter:wght@400;600&display=swap" rel="stylesheet">
<style>
  :root{ --bg:#0f172a; --card:rgba(30,41,59,0.7); --text:white; --accent:#3b82f6; }
  body{margin:0;font-family:'Inter', system-ui;background:var(--bg);color:var(--text);display:flex;justify-content:center;align-items:center;height:100vh;}
  .wrap{width:380px;padding:35px 30px;background:var(--card);border-radius:20px;border:1px solid rgba(255,255,255,0.08);backdrop-filter:blur(12px); box-shadow: 0 20px 40px rgba(0,0,0,0.3); }
  
  /* BRANDING */
  .logo-container { text-align: center; margin-bottom: 30px; }
  h2.brand { 
    margin: 0;
    font-family: 'Playfair Display', serif;
    font-size: 36px;
    font-weight: 900;
    text-transform: uppercase;
    background: linear-gradient(135deg, #ffffff 0%, #cbd5e1 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    letter-spacing: 2px;
  }
  .credit { font-size:10px; color:#64748b; font-weight:600; letter-spacing: 2px; margin-top: 6px; text-transform: uppercase;}
  
  /* INPUTS & WRAPPERS */
  input,select{width:100%;padding:12px;margin:8px 0;background:rgba(0,0,0,0.2);border:1px solid rgba(255,255,255,0.1);color:white;border-radius:10px;box-sizing:border-box; transition: all 0.3s ease; outline: none;}
  input:focus, select:focus { border-color: var(--accent); background: rgba(0,0,0,0.4); }
  select option { background: #1e293b; color: white; }

  /* PASSWORD EYE STYLING */
  .password-wrap { position: relative; width: 100%; margin: 8px 0; }
  .password-wrap input { margin: 0; padding-right: 40px; } /* Space for the eye */
  .toggle-eye {
    position: absolute;
    right: 12px;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    cursor: pointer;
    font-size: 16px;
    padding: 0;
    opacity: 0.6;
    transition: opacity 0.2s;
  }
  .toggle-eye:hover { opacity: 1; }
  
  /* BUTTONS */
  button.primary{ width:100%; padding:12px; background:linear-gradient(to right, var(--accent), #2563eb); border:none; border-radius:10px; color:white; font-weight:600; margin-top:15px; cursor:pointer; display: flex; justify-content: center; align-items: center; min-height: 45px; transition: transform 0.2s, opacity 0.2s; }
  button.primary:hover { opacity: 0.9; transform: translateY(-1px); }
  button:disabled{opacity:0.7;cursor:not-allowed; transform: none;}
  
  .link{color:#94a3b8;font-size:13px;text-decoration:none;cursor:pointer;background:none;border:none; padding: 5px;}
  .link:hover { color: var(--accent); text-decoration: underline; }
  .hidden{display:none;}
  .notice{padding:10px;margin-top:10px;border-radius:6px;font-size:13px;text-align:center;display:none;}
  .notice.err{background:rgba(220,38,38,0.2);color:#fca5a5;border:1px solid rgba(220,38,38,0.3);}
  .notice.ok{background:rgba(22,163,74,0.2);color:#86efac;border:1px solid rgba(22,163,74,0.3);}
  .loader { width: 20px; height: 20px; border: 3px solid rgba(255, 255, 255, 0.3); border-radius: 50%; border-top-color: #fff; animation: spin 0.8s ease-in-out infinite; }
  @keyframes spin { to { transform: rotate(360deg); } }
</style>
</head>
<body>
<div class="wrap">
  <div class="logo-container">
    <h2 class="brand">Stateline</h2>
    <div class="credit">By Panav Gohil</div>
  </div>
  
  <div id="viewLogin">
    <select id="loginMethod" onchange="toggleLogin()"><option value="roll">Roll Number</option><option value="email">Email</option></select>
    <input id="loginRoll" placeholder="Roll Number">
    <input id="loginEmail" placeholder="Email" class="hidden">
    
    <div class="password-wrap">
      <input id="loginPass" type="password" placeholder="Password">
      <button class="toggle-eye" onclick="togglePass('loginPass', this)">üëÅÔ∏è</button>
    </div>

    <button class="primary" id="btnLogin" onclick="doLogin()">Login</button>
    <div style="text-align:center;margin-top:20px; display:flex; justify-content: space-around;">
      <button class="link" onclick="setView('reg')">Create Account</button>
      <button class="link" onclick="setView('forgot')">Forgot Password?</button>
    </div>
  </div>
  
  <div id="viewReg" class="hidden">
    <h3 style="text-align:center; color:white; margin-top:0;">New Account</h3>
    <div id="regStep1">
      <input id="regName" placeholder="Full Name">
      <input id="regRoll" placeholder="Roll Number">
      <input id="regEmail" placeholder="Email">
      <select id="regBranch"><option value="" disabled selected>Select Branch</option><option value="MCE-1">MCE-1</option><option value="MCE-2">MCE-2</option><option value="MCE-3">MCE-3</option><option value="EP-1">EP-1</option><option value="EP-2">EP-2</option><option value="BT">BT</option><option value="CE-1">CE-1</option><option value="CE-2">CE-2</option><option value="CSE-1">CSE-1</option><option value="CSE-2">CSE-2</option><option value="CSE-3">CSE-3</option><option value="CSE-4">CSE-4</option><option value="CSE-5">CSE-5</option><option value="CSE-6">CSE-6</option><option value="DSA">DSA</option><option value="EE-1">EE-1</option><option value="EE-2">EE-2</option><option value="EE-3">EE-3</option><option value="EE-4">EE-4</option><option value="EE-5">EE-5</option><option value="ECE-1">ECE-1</option><option value="ECE-2">ECE-2</option><option value="ECE-3">ECE-3</option><option value="VLSI">VLSI</option><option value="ENE">ENE</option><option value="IT-1">IT-1</option><option value="IT-2">IT-2</option><option value="CY">Cyber Security</option><option value="ME-1">ME-1</option><option value="ME-2">ME-2</option><option value="ME-3">ME-3</option><option value="ME-4">ME-4</option><option value="AE">AE</option><option value="PIE">PIE</option><option value="SE-1">SE-1</option><option value="SE-2">SE-2</option><option value="SE-3">SE-3</option><option value="CHE">CHE</option></select>
      
      <div class="password-wrap">
        <input id="regPass" type="password" placeholder="Create Password">
        <button class="toggle-eye" onclick="togglePass('regPass', this)">üëÅÔ∏è</button>
      </div>

      <button class="primary" id="btnRegOtp" onclick="sendRegOtp()">Send Verification Code</button>
    </div>
    <div id="regStep2" class="hidden"><p style="color:#86efac;font-size:13px;text-align:center;">Code sent to your email!</p><input id="regOtp" placeholder="Enter 6-digit Code" style="text-align:center; letter-spacing: 2px;"><button class="primary" id="btnRegFinal" onclick="doRegister()">Verify & Register</button></div>
    <button class="link" onclick="setView('login')" style="margin-top:15px; width:100%;">Back to Login</button>
  </div>
  
  <div id="viewForgot" class="hidden">
    <h3 style="text-align:center; color:white; margin-top:0;">Reset Password</h3>
    <div id="forgotStep1"><p style="font-size:13px; color:#94a3b8; text-align:center;">Enter your email to receive a reset code.</p><input id="forgotEmail" placeholder="Registered Email"><button class="primary" id="btnForgotOtp" onclick="sendForgotOtp()">Send Reset Code</button></div>
    <div id="forgotStep2">
      <input id="forgotOtp" placeholder="Enter Code" style="text-align:center; letter-spacing: 2px;">
      
      <div class="password-wrap">
        <input id="forgotNewPass" type="password" placeholder="New Password">
        <button class="toggle-eye" onclick="togglePass('forgotNewPass', this)">üëÅÔ∏è</button>
      </div>

      <button class="primary" id="btnForgotFinal" onclick="doReset()">Change Password</button>
    </div>
    <button class="link" onclick="setView('login')" style="margin-top:15px; width:100%;">Back to Login</button>
  </div>
  <div id="msgBox" class="notice"></div>
</div>

<script>
// =================================================================
// REPLACE WITH YOUR URL
const API_URL = "https://script.google.com/macros/s/AKfycbzJpA1JfJcUGf4TJWGaSHHIt0kHTBqEPB3wsWsZKyYZFeA-QbtTFOafitA7wfDmxjCw9w/exec"; 
// =================================================================

function toggleLogin() { const isRoll = document.getElementById("loginMethod").value === "roll"; document.getElementById("loginRoll").classList.toggle("hidden", !isRoll); document.getElementById("loginEmail").classList.toggle("hidden", isRoll); }
function setView(v) { ['viewLogin','viewReg','viewForgot'].forEach(id=>document.getElementById(id).classList.add('hidden')); document.getElementById('view'+v.charAt(0).toUpperCase()+v.slice(1)).classList.remove('hidden'); document.getElementById('msgBox').style.display='none'; }

// NEW: Toggle Password Visibility
function togglePass(inputId, btn) {
  const input = document.getElementById(inputId);
  if (input.type === "password") {
    input.type = "text";
    btn.innerText = "üôà"; // Change to 'hide' icon
  } else {
    input.type = "password";
    btn.innerText = "üëÅÔ∏è"; // Change to 'show' icon
  }
}

async function post(data, btnId) {
  const btn = document.getElementById(btnId); const origText = btn.innerText;
  btn.innerHTML = '<div class="loader"></div>'; btn.disabled = true; document.getElementById('msgBox').style.display='none';
  try { const res = await fetch(API_URL, { method: "POST", body: JSON.stringify(data) }); const json = await res.json(); btn.innerHTML = origText; btn.disabled = false; return json; } 
  catch(e) { btn.innerHTML = origText; btn.disabled = false; showMsg("Connection Error. Check internet.", "err"); return { status: "error" }; }
}
function showMsg(txt, type) { const m = document.getElementById('msgBox'); m.innerText = txt; m.className = "notice " + type; m.style.display='block'; }

async function doLogin() {
  const method = document.getElementById("loginMethod").value;
  const id = method==='roll' ? document.getElementById('loginRoll').value : document.getElementById("loginEmail").value;
  const pass = document.getElementById('loginPass').value;
  const r = await post({ type:"login", identifier:id, password:pass }, 'btnLogin');
  if(r.status==="success") {
    localStorage.setItem("userName", r.name); localStorage.setItem("userRoll", r.roll); localStorage.setItem("userBranch", r.branch); localStorage.setItem("userPass", pass);
    if(r.schedule) localStorage.setItem("mySchedule", r.schedule);
    window.location.href="index.html";
  } else showMsg(r.message||"Login failed", "err");
}

async function sendRegOtp() {
  const data = { type: "reg-send-otp", name: document.getElementById('regName').value, roll: document.getElementById('regRoll').value, email: document.getElementById('regEmail').value, branch: document.getElementById('regBranch').value, password: document.getElementById('regPass').value };
  if(!data.branch) return showMsg("Please select a branch", "err");
  const r = await post(data, 'btnRegOtp');
  if(r.status==="otp_sent") { document.getElementById('regStep1').classList.add('hidden'); document.getElementById('regStep2').classList.remove('hidden'); } else showMsg(r.message, "err");
}
async function doRegister() { const r = await post({ type: "reg-complete", name: document.getElementById('regName').value, roll: document.getElementById('regRoll').value, email: document.getElementById('regEmail').value, branch: document.getElementById('regBranch').value, password: document.getElementById('regPass').value, otp: document.getElementById('regOtp').value }, 'btnRegFinal'); if(r.status==="success") { showMsg("Account Created! Login now.", "ok"); setTimeout(()=>setView('login'), 2000); } else showMsg(r.message, "err"); }
async function sendForgotOtp() { const r = await post({ type:"forgot-send-otp", email:document.getElementById('forgotEmail').value }, 'btnForgotOtp'); if(r.status==="otp_sent") { document.getElementById('forgotStep1').classList.add('hidden'); document.getElementById('forgotStep2').classList.remove('hidden'); } else showMsg(r.message, "err"); }
async function doReset() { const r = await post({ type: "forgot-complete", email: document.getElementById('forgotEmail').value, otp: document.getElementById('forgotOtp').value, newPassword: document.getElementById('forgotNewPass').value }, 'btnForgotFinal'); if(r.status==="success") { showMsg("Password updated successfully!", "ok"); setTimeout(()=>setView('login'), 2000); } else showMsg(r.message, "err"); }
</script>
</body>
</html>
